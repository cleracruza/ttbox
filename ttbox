#!/usr/bin/env python

import yaml
import argparse
import sys

def parse_arguments():
    parser = argparse.ArgumentParser(description='Extracts infos from tttool yaml file')

    parser.add_argument('MODE',
                        choices=['dump-product-id', 'dump-oids'],
                        help='Gives the mode of operation')

    parser.add_argument('YAML_FILE',
                        help='YAML file to parse')

    return parser.parse_args()


def error(msg):
    sys.stderr.write("%s\n" % (msg))
    sys.exit(1)


def getYaml(file_name):
    with open(file_name, 'r') as stream:
        try:
            return yaml.load(stream)
        except yaml.YAMLError as exc:
            error(str(exc))

if __name__ == '__main__':
    args = parse_arguments()
    if args.MODE == 'dump-product-id':
        yaml = getYaml(args.YAML_FILE)
        print(yaml.get('product-id', None))
    elif args.MODE == 'dump-oids':
        yaml = getYaml(args.YAML_FILE)
        print("\n".join(sorted(yaml.get('scripts', {}).keys() + ['START'])))
    else:
        error("Unknown mode '%s'" % (args.MODE))
